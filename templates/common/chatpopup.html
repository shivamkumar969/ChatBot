<style>
    /* --- GENERAL PAGE & WIDGET CONTAINER STYLES --- */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: #f4f4f9;
        padding: 0;
        margin: 0;
        height: 150vh; /* For scrolling demo */
    }
    
    .chat-widget-container {
        /* position: fixed;
        bottom: 2rem;
        right: 2rem;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        z-index: 1000; */
        position: fixed;
        bottom: 2rem;
        right: .5rem;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        z-index: 1000;
        
        /* NEW: Visibility logic is now on the main container */
        opacity: 0;
        pointer-events: none;
        transform: translateY(20px);
        transition: all 0.3s ease-in-out;
    }

    /* --- CHAT WIDGET STYLES (SIMPLIFIED & COMBINED) --- */
    .chat-widget {
        width: 370px;
        margin-bottom: 1rem;
        box-shadow: 0 5px 25px rgba(0,0,0,0.2);
        border-radius: 20px;
        overflow: hidden;
        background-color: #f1f0f0;
        
        /* Hiding/Showing Logic */
        opacity: 0;
        transform: translateY(20px) scale(0.95);
        transition: all 0.3s ease-in-out;
        pointer-events: none;
    }

    .chat-widget.show {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
    }
    
    /* --- CHAT HEADER --- */
    .chat-header {
        background-image: linear-gradient(90deg, rgb(119, 186, 225), rgb(0, 187, 255));
        padding: 15px 20px;
        position: relative; /* For positioning the close button */
    }
    .chat-header-logo {
        height: 60px;
        width: 60px;
        border-radius: 50%;
        mix-blend-mode: screen;
    }
    .chat-header h1 {
        color: white;
        font-weight: 600;
        font-size: 1.75rem;
        margin-bottom: 0;
    }
    .chat-header p {
        color: #e0f7ff;
        margin-bottom: 0;
    }
    .online-indicator {
        color: #2bff00;
    }
    .close-button {
        color: rgba(255, 255, 255, 0.7);
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s;
    }
    .close-button:hover {
        color: white;
    }

    /* --- CHAT BODY & MESSAGES --- */
    #dv_chatwindows {
        height: 400px;
        overflow-y: scroll;
        padding: 20px;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    #dv_chatwindows::-webkit-scrollbar {
        display: none;
    }
    .message-row {
        display: flex;
        align-items: flex-end;
        margin-bottom: 15px;
    }
    .message-box {
        padding: 12px 18px;
        border-radius: 20px;
        max-width: 80%;
        line-height: 1.4;
    }
    .logo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .bot .logo { margin-right: 10px; }
    .bot .message-box {
        background-color: #f1f0f0;
        border-bottom-left-radius: 5px;
    }
    .user { 
        justify-content: flex-end; 
    }
    .user .logo { 
        margin-left: 10px; 
    }
    .user .message-box {
        background-color: #f1f0f0;
        border-bottom-right-radius: 5px;
    }

    /* --- CHAT FOOTER --- */
    .chat-footer {
        padding: 15px 20px;
        background-color: #f1f0f0;
    }
    
    /* --- FLOATING BUTTON --- */
    .chat-button {
        /* width: 64px;
        height: 64px;
        background-color: #007bff;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2); */
        /* MODIFIED: Hide by default */
        /* opacity: 0;
        pointer-events: none;
        transform: scale(0.9);
        transition: transform 0.3s ease-in-out; */
        width: 64px;
        height: 64px;
        background-color: #007bff;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s ease-in-out;
        /* REMOVED: The opacity and transform properties are now controlled by the parent */

    }
    /* NEW: Style for when the button is visible */
    .chat-button.show {
        opacity: 1;
        pointer-events: auto;
        transform: scale(1);
    }

    .chat-button:hover {
        transform: scale(1.1);
    }

    /* --- CHAT TOOLTIP / POP-UP TEXT (MODIFIED) --- */
    .chat-tooltip {
        position: absolute;
        bottom: 80px; /* Position above the button */
        right: 20px;  /* Align with the button */
        background-color: #007bff; /* Match button color */
        color: white;
        padding: 10px 18px;
        border-radius: 10px; /* Slightly more rounded */
        box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Stronger shadow */
        font-size: 16px; /* Slightly larger text */
        font-weight: bold; /* Make the text stand out */
        white-space: nowrap;

        opacity: 0;
        transform: translateY(15px); /* Slide up slightly */
        transition: all 0.3s ease-in-out;
        pointer-events: none;
    }

    /* Arrow pointing to the button (MODIFIED) */
    /* .chat-tooltip::after {
        content: '';
        position: absolute;
        top: 100%; /* Position below the tooltip */
        /* left: 50%; /* Center horizontally */
        /* margin-left: -8px;
        border-width: 8px;
        border-style: solid; */
        /* border-color: #007bff transparent transparent transparent; Arrow color matches tooltip */
    /* } */

    /* Class to control visibility */
    .chat-tooltip.show {
        opacity: 1;
        transform: translateX(0);
    }

    /* NEW: Class to show the entire container */
    .chat-widget-container.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
    }
    .chat-tooltip {
        opacity: 1;
        transform: translateY(0); /* This animates it sliding up into place */
    }

    /* NEW RULE: Hide the tooltip when the chat window is open */
    #chatWidget.show + #chatTooltip {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out;
    }
</style>

<div class="chat-widget-container show">  
    <div id="chatWidget" class="chat-widget">
        <div class="chat-header">
            <span class="close-button">&times;</span>
            <div class="d-flex align-items-center">
                <div class="col-auto">
                    <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" alt="Logo" class="chat-header-logo"/>
                </div>
                <div class="col ps-3">
                    <h1>Need help?</h1>
                    <p><i class="fa-solid fa-circle online-indicator"></i> We reply immediately</p>
                </div>
            </div>
        </div>

        <div id="dv_chatwindows">
            </div>

        <div class="chat-footer">
            <div class="d-flex align-items-center">
                <input type="text" class="form-control rounded-pill" id="txtchat" placeholder="Type your query...">
                <button type="button" id="btnsend" class="btn btn-info rounded-circle btn-lg text-white ms-2">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="chatTooltip" class="chat-tooltip">Need help? Chat with us!</div>

    <button id="chatButton" class="chat-button btn btn-primary d-flex align-items-center justify-content-center">
        <i class="fa-solid fa-comments fa-xl"></i>
    </button>
</div>

<!-- <script>
    $(document).ready(function(){
        // --- Elements ---
        const chatContainer = $('.chat-widget-container'); 
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');

        // --- (NEW) Functions to control the hide/show cycle ---
        function hideContainer() {
            chatContainer.removeClass('show');
            // After hiding, wait 20 seconds then show it again
            setTimeout(showContainer, 10000); 
        }

        function showContainer() {
            chatContainer.addClass('show');
            // After showing, wait 5 seconds then hide it again
            setTimeout(hideContainer, 5000);
        }

        // --- Start the first cycle ---
        // The widget is already visible, so we start by waiting 5 seconds before hiding it.
        setTimeout(hideContainer, 5000);


        // --- Code for making the chatbox work ---

        $(document).on('click', function(event) {
            if (chatWidget.hasClass('show') && 
                $(event.target).closest('#chatWidget').length === 0 &&
                $(event.target).closest('#chatButton').length === 0) {
                chatWidget.removeClass('show');
            }
        });

        function toggleWidget() {
            chatWidget.toggleClass('show');
        }

        chatButton.on('click', toggleWidget);
        closeBtn.on('click', () => chatWidget.removeClass('show'));
        
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                     <div class="message-box">${cur_chat}</div>
                                     <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                   </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                      </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script> -->

<!-- <script>
    $(document).ready(function(){
        // --- Elements ---
        const chatContainer = $('.chat-widget-container'); 
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');

        // --- (MODIFIED) Timer logic with variables to hold timer IDs ---
        let hideTimer;
        let showTimer;

        function hideContainer() {
            chatContainer.removeClass('show');
            // After hiding, wait 10 seconds then show it again
            showTimer = setTimeout(showContainer, 10000); 
        }

        function showContainer() {
            chatContainer.addClass('show');
            // After showing, wait 5 seconds then hide it again
            hideTimer = setTimeout(hideContainer, 5000);
        }

        // --- Start the first cycle ---
        hideTimer = setTimeout(hideContainer, 5000);

        
        // --- (MODIFIED) Click handler for the main chat button ---
        chatButton.on('click', function() {
            // 1. Stop the automatic hide/show cycle completely
            clearTimeout(hideTimer);
            clearTimeout(showTimer);

            // 2. Make sure the widget container is now permanently visible
            chatContainer.addClass('show');

            // 3. Open or close the actual chat WINDOW
            chatWidget.toggleClass('show');
        });


        // --- Code for making the chatbox work ---

        $(document).on('click', function(event) {
            if (chatWidget.hasClass('show') && 
                $(event.target).closest('#chatWidget').length === 0 &&
                $(event.target).closest('#chatButton').length === 0) {
                chatWidget.removeClass('show');
            }
        });

        // The close button just closes the inner chat window
        closeBtn.on('click', () => chatWidget.removeClass('show'));
        
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                     <div class="message-box">${cur_chat}</div>
                                     <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                   </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                      </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script> -->

<!-- <script>
    $(document).ready(function(){
        // --- Elements ---
        const chatContainer = $('.chat-widget-container'); 
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const chatTooltip = $('#chatTooltip');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');

        // --- Timer logic with variables to hold timer IDs ---
        let hideTimer;
        let showTimer;

        function hideContainer() {
            chatContainer.removeClass('show');
            showTimer = setTimeout(showContainer, 10000); 
        }

        function showContainer() {
            chatContainer.addClass('show');
            hideTimer = setTimeout(hideContainer, 5000);
        }

        hideTimer = setTimeout(hideContainer, 5000);

        
        // --- Click handler for the main chat button ---
        chatButton.on('click', function() {
            // 1. Stop the automatic hide/show cycle
            clearTimeout(hideTimer);
            clearTimeout(showTimer);

            // 2. Make sure the widget container is permanently visible
            chatContainer.addClass('show');

            // 3. Open or close the actual chat WINDOW
            chatWidget.toggleClass('show');
            
            // 4. Check if the chat window is now open
            if (chatWidget.hasClass('show')) {
                // If it's open, hide the tooltip text
                chatTooltip.removeClass('show');
            }
        });


        // --- Code for making the chatbox work ---

        $(document).on('click', function(event) {
            // THE FIX IS IN THE LINE BELOW
            if (chatWidget.hasClass('show') && 
                $(event.target).closest('#chatWidget').length === 0 &&
                $(event.target).closest('#chatButton').length === 0) {
                chatWidget.removeClass('show');
            }
        });

        closeBtn.on('click', () => chatWidget.removeClass('show'));
        
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                     <div class="message-box">${cur_chat}</div>
                                     <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                   </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                      </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script> -->

<script>
    $(document).ready(function(){
        // --- Elements ---
        const chatContainer = $('.chat-widget-container'); 
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const chatTooltip = $('#chatTooltip');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');

        // --- Timer logic ---
        let hideTimer;
        let showTimer;

        function hideContainer() {
            chatContainer.removeClass('show');
            showTimer = setTimeout(showContainer, 10000); 
        }

        function showContainer() {
            chatContainer.addClass('show');
            hideTimer = setTimeout(hideContainer, 5000);
        }

        // --- (NEW) Function to reset the widget and restart the cycle ---
        function resetAndStartCycle() {
            // 1. Close the chat window
            chatWidget.removeClass('show');
            
            // 2. Stop any existing timers to prevent conflicts
            clearTimeout(hideTimer);
            clearTimeout(showTimer);

            // 3. Restart the automatic cycle by calling the first function in the loop
            hideContainer();
        }

        // --- Start the first cycle on page load ---
        hideTimer = setTimeout(hideContainer, 5000);

        
        // --- Click handler for the main chat button ---
        chatButton.on('click', function() {
            clearTimeout(hideTimer);
            clearTimeout(showTimer);
            chatContainer.addClass('show');
            chatWidget.toggleClass('show');
            
            if (chatWidget.hasClass('show')) {
                chatTooltip.removeClass('show');
            }
        });

        // --- (MODIFIED) Handlers for closing the chat window ---

        // When clicking outside the widget
        $(document).on('click', function(event) {
            if (chatWidget.hasClass('show') && 
                $(event.target).closest('#chatWidget').length === 0 &&
                $(event.target).closest('#chatButton').length === 0) {
                
                resetAndStartCycle(); // Reset and restart the cycle
            }
        });

        // When clicking the 'X' close button
        closeBtn.on('click', resetAndStartCycle); // Reset and restart the cycle
        

        // --- Code for sending messages ---
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                     <div class="message-box">${cur_chat}</div>
                                     <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                   </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                      </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script>
