<style>
    /* --- GENERAL PAGE & WIDGET CONTAINER STYLES --- */
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: #f4f4f9;
        padding: 0;
        margin: 0;
        height: 150vh; /* For scrolling demo */
    }
    
    .chat-widget-container {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        z-index: 1000;
    }

    /* --- CHAT WIDGET STYLES (SIMPLIFIED & COMBINED) --- */
    .chat-widget {
        width: 370px;
        margin-bottom: 1rem;
        box-shadow: 0 5px 25px rgba(0,0,0,0.2);
        border-radius: 20px;
        overflow: hidden;
        background-color: #f1f0f0;
        
        /* Hiding/Showing Logic */
        opacity: 0;
        transform: translateY(20px) scale(0.95);
        transition: all 0.3s ease-in-out;
        pointer-events: none;
    }

    .chat-widget.show {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
    }
    
    /* --- CHAT HEADER --- */
    .chat-header {
        background-image: linear-gradient(90deg, rgb(119, 186, 225), rgb(0, 187, 255));
        padding: 15px 20px;
        position: relative; /* For positioning the close button */
    }
    .chat-header-logo {
        height: 60px;
        width: 60px;
        border-radius: 50%;
    }
    .chat-header h1 {
        color: white;
        font-weight: 600;
        font-size: 1.75rem;
        margin-bottom: 0;
    }
    .chat-header p {
        color: #e0f7ff;
        margin-bottom: 0;
    }
    .online-indicator {
        color: #2bff00;
    }
    .close-button {
        color: rgba(255, 255, 255, 0.7);
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s;
    }
    .close-button:hover {
        color: white;
    }

    /* --- CHAT BODY & MESSAGES --- */
    #dv_chatwindows {
        height: 400px;
        overflow-y: scroll;
        padding: 20px;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    #dv_chatwindows::-webkit-scrollbar {
        display: none;
    }
    .message-row {
        display: flex;
        align-items: flex-end;
        margin-bottom: 15px;
    }
    .message-box {
        padding: 12px 18px;
        border-radius: 20px;
        max-width: 80%;
        line-height: 1.4;
    }
    .logo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .bot .logo { margin-right: 10px; }
    .bot .message-box {
        background-color: #f1f0f0;
        border-bottom-left-radius: 5px;
    }
    .user { 
        justify-content: flex-end; 
    }
    .user .logo { 
        margin-left: 10px; 
    }
    .user .message-box {
        background-color: #f1f0f0;
        border-bottom-right-radius: 5px;
    }

    /* --- CHAT FOOTER --- */
    .chat-footer {
        padding: 15px 20px;
        background-color: #f1f0f0;
    }
    
    /* --- FLOATING BUTTON --- */
    .chat-button {
        width: 64px;
        height: 64px;
        background-color: #007bff;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s ease-in-out;
    }
    .chat-button:hover {
        transform: scale(1.1);
    }

    /* --- CHAT TOOLTIP / POP-UP TEXT (MODIFIED) --- */
    .chat-tooltip {
        position: absolute;
        bottom: 80px; /* Position above the button */
        right: 20px;  /* Align with the button */
        background-color: #007bff; /* Match button color */
        color: white;
        padding: 10px 18px;
        border-radius: 10px; /* Slightly more rounded */
        box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* Stronger shadow */
        font-size: 16px; /* Slightly larger text */
        font-weight: bold; /* Make the text stand out */
        white-space: nowrap;
        opacity: 0;
        transform: translateY(15px); /* Slide up slightly */
        transition: all 0.3s ease-in-out;
        pointer-events: none;
        z-index: 1001; /* Ensure it's above the button */
    }

    /* Arrow pointing to the button (MODIFIED) */
    /* .chat-tooltip::after {
        content: '';
        position: absolute;
        top: 100%; /* Position below the tooltip */
        /* left: 50%; /* Center horizontally */
        /* margin-left: -8px;
        border-width: 8px;
        border-style: solid; */
        /* border-color: #007bff transparent transparent transparent; Arrow color matches tooltip */
    /* } */

    /* Class to control visibility */
    .chat-tooltip.show {
        opacity: 1;
        transform: translateX(0);
    }
</style>

<div class="chat-widget-container">  
    <div id="chatWidget" class="chat-widget">
        <div class="chat-header">
            <span class="close-button">&times;</span>
            <div class="d-flex align-items-center">
                <div class="col-auto">
                    <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" alt="Logo" class="chat-header-logo"/>
                </div>
                <div class="col ps-3">
                    <h1>Need help?</h1>
                    <p><i class="fa-solid fa-circle online-indicator"></i> We reply immediately</p>
                </div>
            </div>
        </div>

        <div id="dv_chatwindows">
            </div>

        <div class="chat-footer">
            <div class="d-flex align-items-center">
                <input type="text" class="form-control rounded-pill" id="txtchat" placeholder="Type your query...">
                <button type="button" id="btnsend" class="btn btn-info rounded-circle btn-lg text-white ms-2">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="chatTooltip" class="chat-tooltip">Need help? Chat with us!</div>

    <button id="chatButton" class="chat-button btn btn-primary d-flex align-items-center justify-content-center">
        <i class="fa-solid fa-comments fa-xl"></i>
    </button>
</div>

<!-- <script>

    $(document).ready(function(){
        // --- Elements ---
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');
        const chatTooltip = $('#chatTooltip');
        
        // --- Show and Hide Tooltip ---
        // After a 1-second delay, show the tooltip
        setTimeout(function() {
            chatTooltip.addClass('show');
        }, 1000); 

        // After another 5 seconds, hide it again
        setTimeout(function() {
            chatTooltip.removeClass('show');
        }, 6000); // 1000ms delay + 5000ms visible

        // --- Toggle Widget Visibility ---
        function toggleWidget() {
            chatWidget.toggleClass('show');
        }

        chatButton.on('click', toggleWidget);
        closeBtn.on('click', () => chatWidget.removeClass('show'));
        
        // --- Send Message ---
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                    <div class="message-box">${cur_chat}</div>
                                    <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                    </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                    </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script> -->


<script>
    $(document).ready(function(){
        // --- Elements ---
        const chatWidget = $('#chatWidget');
        const chatButton = $('#chatButton');
        const closeBtn = $('.close-button');
        const sendBtn = $('#btnsend');
        const chatInput = $('#txtchat');
        const chatWindow = $('#dv_chatwindows');
        const chatTooltip = $('#chatTooltip');
        
        // --- Show and Hide Tooltip ---
        // After a 1-second delay, show the tooltip
        setTimeout(function() {
            chatTooltip.addClass('show');
        }, 1000); 

        // After another 5 seconds, hide it again
        setTimeout(function() {
            chatTooltip.removeClass('show');
        }, 6000); // 1000ms delay + 5000ms visible

        // --- (NEW) Close Widget on Outside Click ---
        $(document).on('click', function(event) {
            // Check if the widget is open AND if the click was NOT on the widget or the open button
            if (chatWidget.hasClass('show') && 
                $(event.target).closest('#chatWidget').length === 0 &&
                $(event.target).closest('#chatButton').length === 0) {
                
                // If conditions are met, close the widget
                chatWidget.removeClass('show');
            }
        });

        // --- Toggle Widget Visibility ---
        function toggleWidget() {
            chatWidget.toggleClass('show');
        }

        chatButton.on('click', toggleWidget);
        closeBtn.on('click', () => chatWidget.removeClass('show'));
        
        // --- Send Message ---
        function sendMessage() {
            var cur_chat = $('#txtchat').val().trim();
            if(cur_chat.length > 0){
                var chat_window_obj = $('#dv_chatwindows');
                
                var user_html = `<div class="message-row user">
                                    <div class="message-box">${cur_chat}</div>
                                    <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                 </div>`;
                chat_window_obj.append(user_html);

                $("#txtchat").val("");
                chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                    var bot_html = `<div class="message-row bot">
                                        <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                        <div class="message-box">${bot_ans}</div>
                                    </div>`;
                    chat_window_obj.append(bot_html);
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                });
            }
        }

        sendBtn.on('click', sendMessage);
        chatInput.on('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });
    });
</script>
