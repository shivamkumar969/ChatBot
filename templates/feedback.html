<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback</title>
    {% include 'common/mylinks.html' %}
    <style>
        body {
            background-color: #fff9f7;
        }
        .feedback-card {
            background-color: white;
            border-radius: 15px;
            border: none;
        }
        .feedback-title {
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            color: #3b3b35;
            font-weight: 600;
        }
        .err {
            color: #d9534f;
            display: block;
            font-size: 0.875em;
            margin-top: 0.25rem;
        }

        /* --- Star Rating Styles --- */
        .rating-question {
            font-weight: 500;
            color: #495057;
        }
        .rating-stars {
            display: flex;
            flex-direction: row-reverse; /* This is key for the hover effect */
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        .rating-stars input[type="radio"] {
            display: none; /* Hide the actual radio buttons */
        }
        .rating-stars label {
            font-size: 2.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        /* Hover effect: makes stars yellow up to the one you're hovering on */
        /* .rating-stars label:hover,
        .rating-stars label:hover ~ label {
            color: #ffc107;
        } */
        /* Checked state: keeps stars yellow after clicking */
        /* .rating-stars input[type="radio"]:checked ~ label {
            color: #ffc107;
        } */
    </style>
</head>
<body class="pt-0">
    <div class="container-fluid p-0">
        {% include 'common/header.html' %}

        <div class="container my-5">
            <div class="row">
                <div class="col-lg-8 col-md-10 mx-auto">
                    <div class="card shadow-sm p-4 p-md-5 feedback-card">
                        <h1 class="text-center feedback-title mb-4">Feedback</h1>
                        <form action="/submit_feedback" method="post" id="feedbackForm">
                            
                            <!-- <div class="text-center mb-3">
                                <h4 class="rating-question">How would you rate your overall experience with our service?</h4>
                                <div class="rating-stars">
                                    <input type="radio" id="star5" name="rating" value="5" /><label for="star5">★</label>
                                    <input type="radio" id="star4" name="rating" value="4" /><label for="star4">★</label>
                                    <input type="radio" id="star3" name="rating" value="3" /><label for="star3">★</label>
                                    <input type="radio" id="star2" name="rating" value="2" /><label for="star2">★</label>
                                    <input type="radio" id="star1" name="rating" value="1" /><label for="star1">★</label>
                                </div>
                            </div> -->

                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" name="fename" id="fname" placeholder="Enter Your Full Name">
                                <label for="fname">Enter Your Full Name</label>
                            </div>
                            <select class="form-select mb-3" name="fegender" id="fgender">
                                <option selected disabled>Choose Your Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                            
                            <div class="form-floating mb-3">
                                <input type="email" class="form-control" name="feemail" id="femail" placeholder="name@example.com">
                                <label for="femail">Email address</label>
                            </div>
                            <div class="form-floating mb-3">
                                <textarea class="form-control" placeholder="Leave a suggestion here" name="fesuggestion" id="fsuggestion" style="height: 100px; resize: none;"></textarea>
                                <label for="fsuggestion">Suggestions (if any)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <textarea class="form-control" placeholder="Leave feedback here" name="fefeedback" id="ffeedback" style="height: 100px; resize: none;"></textarea>
                                <label for="ffeedback">Feedback Message</label>
                            </div>
                            <div class="d-grid gap-2 mb-3">
                                <button class="btn btn-info text-white py-2" id="fbtnsave" type="submit" style="font-size: 1.2rem;">Submit Feedback</button>
                            </div>
                        </form>
                    </div>
                    {% if msgg %}
                        <script>
                            alert("{{ msgg }}");
                            window.location.href = "{{url_for('index')}}"; 
                        </script>
                    {% endif %}
                </div>
            </div>
        </div>
        {% include 'common/footer.html' %}
    </div>

    <script>
        // More accurate word count function
        function getWordCount(str) {
            if (!str || str.trim() === '') {
                return 0;
            }
            return str.trim().split(/\s+/).length;
        }

        $(document).ready(function(){
            // Use form submit event for better practice
            $('#feedbackForm').submit(function(event){
                var status = true;
                
                var fname = $('#fname').val().trim();
                var fgender = $('#fgender').val();
                var femail = $('#femail').val().trim();
                var fsuggestion = $('#fsuggestion').val().trim();
                var ffeedback = $('#ffeedback').val().trim();
                
                // Remove old error messages
                $('.err').remove();
                
                // Validate Star Rating
                // if ($('.rating-stars input[name="rating"]:checked').length === 0) {
                //     $('.rating-stars').after("<span class='err text-center'>Please select a rating.</span>");
                //     status = false;
                // }

                // Validate Name
                if (fname.length == 0) {
                    $("#fname").after("<span class='err'>Please enter your name.</span>");
                    status = false;
                } else if (fname.length < 2) {
                    $("#fname").after("<span class='err'>Please enter a valid name.</span>");
                    status = false;
                }
                
                // Validate Gender
                if (fgender == "Choose Your Gender") {
                    $("#fgender").after("<span class='err'>Please select your gender.</span>");
                    status = false;
                }
                
                // Validate Email
                // var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Simple email regex
                // if (femail.length == 0) {
                //     $("#femail").after("<span class='err'>Please enter your email.</span>");
                //     status = false;
                // } else if (!emailPattern.test(femail)) {
                //     $("#femail").after("<span class='err'>Please enter a valid email address.</span>");
                //     status = false;
                // }

                // Validate Form Email
                if(femail.length==0){
                    $("#femail").after("<span class='err'>Please enter your email.</span>");
                    status=false;
                }
                else if(!femail.includes('@')){
                    $("#femail").after("<span class='err'>Please enter your valid email.</span>");
                    status=false;
                }

                // Validate Suggestions (optional, can be empty)
                
                // Validate Feedback
                // if (ffeedback.length === 0) {
                //     $("#ffeedback").after("<span class='err'>Please enter your feedback.</span>");
                //     status = false;
                // } else if (getWordCount(ffeedback) < 5) {
                //     $("#ffeedback").after("<span class='err'>Please provide at least 5 words in your feedback.</span>");
                //     status = false;
                // }
                
                // Validate Form Feedback
                if(ffeedback.length==0){
                    $("#ffeedback").after("<span class='err'>Please enter your Feedback.</span>");
                    status=false;
                }
                else{
                    var wc=getWordCount(ffeedback);
                    if(wc<9){
                        $("#ffeedback").after("<span class='err'>Please enter your Feedback in detail</span>");
                        status=false;
                    }
                }

                // if (status === false) {
                //     event.preventDefault(); // Stop the form from submitting if validation fails
                // }
                
                return status;
            });
        });
        function getWordCount(sent)
        {
            var x,wcount=0,ch;
            for(x=0;x<sent.length;x++){
                ch=sent.charAt(x);
                if(ch==' '|| ch==',' || ch=='?' || ch==';' ||ch=='!' || ch=='.'){
                    wcount++;
                }
            }
            return wcount;
        }
    </script>
</body>
</html>
