<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    {% include 'common/mylinks.html' %}
</head>
<style>
    /* --- GENERAL CHAT STYLES --- */
    .chat-container {
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }
    .chat-widget {
        border-radius: 25px;
        background-color: beige;
        overflow: hidden; /* Ensures child elements respect the border radius */
    }

    /* --- CHAT HEADER --- */
    .chat-header {
        background-image: linear-gradient(90deg, rgb(119, 186, 225), rgb(0, 187, 255));
        padding: 15px 20px;
    }
    .chat-header-logo {
        height: 60px;
        width: 60px;
        border-radius: 50%;
        mix-blend-mode: screen;
    }
    .chat-header-text h1 {
        color: white;
        font-weight: 600;
        font-size: 1.75rem;
        margin-bottom: 0;
    }
    .chat-header-text p {
        color: #e0f7ff;
        margin-bottom: 0;
    }
    .online-indicator {
        color: #2bff00;
    }

    /* --- CHAT BODY & MESSAGES --- */
    .chat-body {
        padding: 15px;
    }
    #dv_chatwindows {
        height: 400px;
        overflow-y: scroll;
        padding: 10px;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    #dv_chatwindows::-webkit-scrollbar {
        display: none;
    }
    .message-row {
        display: flex;
        align-items: flex-end;
        margin-bottom: 15px;
        clear: both;
    }
    .message-box {
        padding: 10px 18px;
        border-radius: 20px;
        max-width: 80%;
    }
    .logo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .bot .logo { margin-right: 10px; }
    .bot .message-box {
        background-color: #f1f0f0;
        border-bottom-left-radius: 5px;
    }
    .user { 
        justify-content: flex-end; 
    }
    .user .logo { 
        margin-left: 10px; 
    }
    .user .message-box {
        background-color: #dcf8c6;
        border-bottom-right-radius: 5px;
    }

    /* --- (UPDATED) CHAT FOOTER (INPUT AREA) --- */
    .chat-footer {
        padding: 15px 20px;
        background-color: beige;
    }
    .chat-footer .form-control {
        border-radius: 50px;
        height: 50px;
        border: 1px solid #ddd;
        box-shadow: none; /* Removes default focus glow */
    }
    .chat-footer .form-control:focus {
        border-color: #0dcaf0; /* Matches the button color on focus */
    }
    .chat-footer .btn-send {
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        border: none;
        flex-shrink: 0; /* Prevents the button from shrinking */
        transition: background-color 0.2s ease-in-out; /* Smooth transition for hover */
    }
    .chat-footer .btn-send:hover {
        background-color: #08a5c4; /* A slightly darker shade for hover */
    }


    /* --- RESPONSIVE ADJUSTMENTS --- */
    @media (max-width: 768px) {
        #dv_chatwindows {
            height: 350px;
        }
        .chat-header-text h1 {
            font-size: 1.5rem;
        }
    }
    .head{
        padding: 0px;
    }
</style>
<body>
    <div class="container-fluid head" style="background-color: #fff9f7;">
        {% include 'common/header.html' %}

        <section id="chat" class="chat-container py-4">
            <div class="container"> 
                <div class="row"> 
                    <h3 class="text-center">How may I help you today?</h3>
                    <hr class="mb-4"/>
                    <div class="col-12 col-md-10 col-lg-8 col-xl-6 mx-auto">
                        <div class="shadow-lg chat-widget">
                            
                            <div class="chat-header">
                                <div class="d-flex align-items-center">
                                    <div class="col-auto">
                                        <a href="#chat">
                                            <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" alt="Logo" class="chat-header-logo"/>
                                        </a>
                                    </div>
                                    <div class="col ps-3 chat-header-text">
                                        <h1>Need help?</h1>
                                        <p><i class="fa-solid fa-circle online-indicator"></i> We reply immediately</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-body">
                                <div id="dv_chatwindows"></div>
                            </div>

                            <div class="chat-footer">
                                <div class="d-flex align-items-center">
                                    <input type="text" class="form-control" id="txtchat" onkeydown="sendOnEnter(event)" placeholder="Type your query or concern..">
                                    
                                    <button type="button" id="btnsend" class="btn btn-info btn-send text-white ms-2">
                                        <i class="fa-solid fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        {% include 'common/footer.html' %}
    </div>
    <script>
        $(document).ready(function(){
            function sendMessage() {
                var cur_chat = $('#txtchat').val().trim();
                if(cur_chat.length > 0){
                    var chat_window_obj = $('#dv_chatwindows');
                    
                    var user_html = `<div class="message-row user">
                                        <div class="message-box">${cur_chat}</div>
                                        <img src="{{url_for('static', filename='images/user.png')}}" class="logo">
                                    </div>`;
                    chat_window_obj.append(user_html);

                    $("#txtchat").val("");
                    chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);

                    $.getJSON("getbotanswer", { userquery: cur_chat }, function(bot_ans){
                        var bot_html = `<div class="message-row bot">
                                            <img src="{{url_for('static', filename='images/mainlogo.jpg')}}" class="logo">
                                            <div class="message-box">${bot_ans}</div>
                                        </div>`;
                        chat_window_obj.append(bot_html);
                        chat_window_obj.scrollTop(chat_window_obj[0].scrollHeight);
                    });
                }
            }

            $("#btnsend").click(sendMessage);

            window.sendOnEnter = function(event) {
                if(event.key === "Enter") {
                    event.preventDefault();
                    sendMessage();
                }
            }
        });
    </script>
</body>
</html>
